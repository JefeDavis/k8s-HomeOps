---
apiVersion: infra.contrib.fluxcd.io/v1alpha1
kind: Terraform
metadata:
  name: authentik-provisioner
  namespace: security
spec:
  path: "./"
  interval: 10m
  approvePlan: auto
  backendConfig:
    disable: true
  cliConfigSecretRef:
    name: tf-cloud-token
    namespace: flux-system
  cloud:
    organization: "davishaus"
    hostname: "app.terraform.io"
    workspaces:
      name: "authentik-provisioner"
  sourceRef:
    kind: OCIRepository
    name: oci-terraform-authentik
    namespace: flux-system
  vars:
    - name: AUTHENTIK_BOOTSTRAP_TOKEN
      valueFrom:
        secretKeyRef:
          name: authentik-secret
          key: AUTHENTIK_BOOTSTRAP_TOKEN
  varsFrom:
    - kind: ConfigMap
      name: tf-authentik-proxy-providers
